let fetch;_0ba‍.w("node-fetch",[["default",["fetch"],function(v){fetch=v}]]);

let page_number = 1;
let page_size = 100;
let api_key = '95A776EF-F8DD-429E-B5F7-44988915688D';
let url = 'https://api.amctheatres.com/v2/theatres/amc-village-7';
let url_showtimes = `https://api.amctheatres.com/v2/theatres/2110/showtimes?page-number=${page_number}&page-size=${page_size}`;
let headers = { "X-AMC-Vendor-Key": api_key };
let theatre_id = 2110;

let movie_showtimes = {};

async function getMovieData() {
    try {
        while (url_showtimes) {
            let response = await fetch(url_showtimes, { headers });
            let data = await response.json();
            let showtimes = data["_embedded"]["showtimes"];
            try {
                url_showtimes = data["_links"]['next']["href"];
            } catch (error) {
                url_showtimes = null;
            }
            for (let showtime of showtimes) {
                let movie = showtime['movieName'];
                let movie_id = showtime['movieId'];
                let abs_movie_time = new Date(showtime['showDateTimeLocal']);
                if (!(movie in movie_showtimes) || movie_showtimes[movie][0] < abs_movie_time) {
                    movie_showtimes[movie] = [abs_movie_time, movie_id];
                }
            }
        }

        for (let movie in movie_showtimes) {
            let [abs_movie_time, movie_id] = movie_showtimes[movie];
            let url_movie = `https://api.amctheatres.com/v2/movies/${movie_id}`;
            let response = await fetch(url_movie, { headers });
            let movieData = await response.json();
            let score = movieData['score'];
            let earliest_showtime = new Date(movieData["earliestShowingUtc"]);
            console.log(`${movie} | ${abs_movie_time} | score: ${score}`);
        }
    } catch (error) {
        _0ba‍.g.console.error('Error occurred:', error);
    }
}

getMovieData().catch(error => _0ba‍.g.console.error('Unhandled promise rejection:', error));
